import{_ as c,r as l,o as p,c as i,b as u,w as a,d as s,a as n,j as r}from"./app-aRFa_rIQ.js";const k={},d=n("h1",{id:"锁表处理",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#锁表处理","aria-hidden":"true"},"#"),s(" 锁表处理")],-1),S=n("h2",{id:"查看锁",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#查看锁","aria-hidden":"true"},"#"),s(" 查看锁")],-1),m=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[n("span",{class:"token comment"},"------------------------------------------"),s(`
`),n("span",{class:"token comment"},"--查询锁表信息"),s(`
`),n("span",{class:"token comment"},"------------------------------------------"),s(`
`),n("span",{class:"token keyword"},"SELECT"),s(` 
  LOC`),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"','"),s(),n("span",{class:"token operator"},"||"),s(" SESS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"SERIAL"),n("span",{class:"token comment"},"# KEY, "),s(`
  LOC`),n("span",{class:"token punctuation"},"."),s("SESSION_ID      SID"),n("span",{class:"token punctuation"},","),s(` 
  SESS`),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"SERIAL"),n("span",{class:"token comment"},"#, "),s(`
  LOC`),n("span",{class:"token punctuation"},"."),s("LOCKED_MODE     锁模式"),n("span",{class:"token punctuation"},","),s(` 
  LOC`),n("span",{class:"token punctuation"},"."),s("ORACLE_USERNAME 登录用户"),n("span",{class:"token punctuation"},","),s(` 
  LOC`),n("span",{class:"token punctuation"},"."),s("OS_USER_NAME    登录机器用户名"),n("span",{class:"token punctuation"},","),s(` 
  SESS`),n("span",{class:"token punctuation"},"."),s("PROGRAM        软件"),n("span",{class:"token punctuation"},","),s(`
  SESS`),n("span",{class:"token punctuation"},"."),s("MACHINE        机器名"),n("span",{class:"token punctuation"},","),s(` 
  SESS`),n("span",{class:"token punctuation"},"."),s("TERMINAL       终端用户名"),n("span",{class:"token punctuation"},","),s(` 
  OBJ`),n("span",{class:"token punctuation"},"."),s("OBJECT_NAME     被锁对象名"),n("span",{class:"token punctuation"},","),s(` 
  SESS`),n("span",{class:"token punctuation"},"."),s("LOGON_TIME     登录数据库时间"),n("span",{class:"token punctuation"},","),s(`
  LOC`),n("span",{class:"token punctuation"},"."),s("LOCKED_MODE     锁定模式"),n("span",{class:"token punctuation"},","),s(`
  SESS`),n("span",{class:"token punctuation"},"."),s("LOCKWAIT       等待"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token string"},"'ALTER SYSTEM KILL SESSION '''"),s(),n("span",{class:"token operator"},"||"),s(" loc"),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"','"),s(),n("span",{class:"token operator"},"||"),s(" sess"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"SERIAL"),n("span",{class:"token comment"},"# || ''';' AS 强制结束会话语句"),s(`
`),n("span",{class:"token keyword"},"FROM"),s(` V$LOCKED_OBJECT LOC
  `),n("span",{class:"token keyword"},"LEFT"),s(),n("span",{class:"token keyword"},"JOIN"),s(" ALL_OBJECTS OBJ "),n("span",{class:"token keyword"},"ON"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("OBJECT_ID "),n("span",{class:"token operator"},"="),s(" OBJ"),n("span",{class:"token punctuation"},"."),s(`OBJECT_ID 
  `),n("span",{class:"token keyword"},"LEFT"),s(),n("span",{class:"token keyword"},"JOIN"),s(" V$"),n("span",{class:"token keyword"},"SESSION"),s(" SESS "),n("span",{class:"token keyword"},"ON"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("OBJECT_ID "),n("span",{class:"token operator"},"="),s(" OBJ"),n("span",{class:"token punctuation"},"."),s("OBJECT_ID "),n("span",{class:"token operator"},"AND"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"="),s(" SESS"),n("span",{class:"token punctuation"},"."),s(`SID 
`),n("span",{class:"token keyword"},"WHERE"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[n("span",{class:"token keyword"},"SELECT"),s(" lo"),n("span",{class:"token punctuation"},"."),s("inst_id"),n("span",{class:"token punctuation"},","),s(`
       lo`),n("span",{class:"token punctuation"},"."),s("oracle_username "),n("span",{class:"token keyword"},"AS"),s(" ora_user"),n("span",{class:"token punctuation"},","),s(`
       lo`),n("span",{class:"token punctuation"},"."),s("os_user_name "),n("span",{class:"token keyword"},"AS"),s(" os_user"),n("span",{class:"token punctuation"},","),s(`
       lo`),n("span",{class:"token punctuation"},"."),s("process"),n("span",{class:"token punctuation"},","),s(`
       lo`),n("span",{class:"token punctuation"},"."),s("locked_mode"),n("span",{class:"token punctuation"},","),s(`
       `),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},"."),s("owner"),n("span",{class:"token punctuation"},","),s(`
       `),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},"."),s("object_name"),n("span",{class:"token punctuation"},","),s(`
       s`),n("span",{class:"token punctuation"},"."),s("sid"),n("span",{class:"token punctuation"},","),s(`
       s`),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"serial"),n("span",{class:"token comment"},"#,"),s(`
       `),n("span",{class:"token string"},"'alter system kill session '''"),s(),n("span",{class:"token operator"},"||"),s(" s"),n("span",{class:"token punctuation"},"."),s("sid "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"','"),s(),n("span",{class:"token operator"},"||"),s(" s"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"serial"),n("span",{class:"token comment"},"# || ',@' ||"),s(`
       s`),n("span",{class:"token punctuation"},"."),s("inst_id "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"''';'"),s(),n("span",{class:"token keyword"},"AS"),s(` kill_ddl
  `),n("span",{class:"token keyword"},"FROM"),s(" gv$locked_object lo"),n("span",{class:"token punctuation"},","),s(" dba_objects "),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},","),s(" gv$"),n("span",{class:"token keyword"},"session"),s(` s
 `),n("span",{class:"token keyword"},"WHERE"),s(" lo"),n("span",{class:"token punctuation"},"."),s("object_id "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},"."),s(`object_id
   `),n("span",{class:"token operator"},"AND"),s(" lo"),n("span",{class:"token punctuation"},"."),s("session_id "),n("span",{class:"token operator"},"="),s(" s"),n("span",{class:"token punctuation"},"."),s(`sid
   `),n("span",{class:"token operator"},"AND"),s(" lo"),n("span",{class:"token punctuation"},"."),s("inst_id "),n("span",{class:"token operator"},"="),s(" s"),n("span",{class:"token punctuation"},"."),s(`inst_id
   `),n("span",{class:"token operator"},"AND"),s(),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},"."),s("owner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'OWNER'"),s(`
   `),n("span",{class:"token operator"},"AND"),s(),n("span",{class:"token keyword"},"do"),n("span",{class:"token punctuation"},"."),s("object_name "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'TEST230317'"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[n("span",{class:"token comment"},"------------------------------------------"),s(`
`),n("span",{class:"token comment"},"--表记录 锁定查询"),s(`
`),n("span",{class:"token comment"},"------------------------------------------"),s(`
`),n("span",{class:"token keyword"},"SELECT"),s(` 
  LOC`),n("span",{class:"token punctuation"},"."),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},","),s(`
  DOBJ`),n("span",{class:"token punctuation"},"."),s("OWNER"),n("span",{class:"token punctuation"},","),s(" DOBJ"),n("span",{class:"token punctuation"},"."),s("OBJECT_NAME"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token string"},"'ALTER SYSTEM KILL SESSION '''"),s(),n("span",{class:"token operator"},"||"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"','"),s(),n("span",{class:"token operator"},"||"),s(" SESS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"SERIAL"),n("span",{class:"token comment"},"# || ''';'"),s(`
`),n("span",{class:"token keyword"},"FROM"),s(` GV$LOCKED_OBJECT LOC
  `),n("span",{class:"token keyword"},"LEFT"),s(),n("span",{class:"token keyword"},"JOIN"),s(" DBA_OBJECTS DOBJ "),n("span",{class:"token keyword"},"ON"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("OBJECT_ID "),n("span",{class:"token operator"},"="),s(" DOBJ"),n("span",{class:"token punctuation"},"."),s(`OBJECT_ID
  `),n("span",{class:"token keyword"},"LEFT"),s(),n("span",{class:"token keyword"},"JOIN"),s(" GV$"),n("span",{class:"token keyword"},"SESSION"),s(" SESS "),n("span",{class:"token keyword"},"ON"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"="),s(" SESS"),n("span",{class:"token punctuation"},"."),s("SID "),n("span",{class:"token operator"},"AND"),s(" LOC"),n("span",{class:"token punctuation"},"."),s("SESSION_ID "),n("span",{class:"token operator"},"="),s(" SESS"),n("span",{class:"token punctuation"},"."),s(`SID
`),n("span",{class:"token keyword"},"WHERE"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token operator"},"="),n("span",{class:"token number"},"1"),s(`
  `),n("span",{class:"token operator"},"AND"),s(" DOBJ"),n("span",{class:"token punctuation"},"."),s("OBJECT_NAME "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),s("表名"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),b=r(`<h2 id="查某session正在执行的sql语句" tabindex="-1"><a class="header-anchor" href="#查某session正在执行的sql语句" aria-hidden="true">#</a> 查某SESSION正在执行的SQL语句</h2><p>查某SESSION 正在执行的SQL语句，从而可以快速定位到哪些操作或者代码导致事务一直进行没有结束等.</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">------------------------------------------</span>
<span class="token comment">--查某SESSION 正在执行的SQL语句，从而可以快速定位到哪些操作或者代码导致事务一直进行没有结束等.</span>
<span class="token comment">------------------------------------------</span>
<span class="token keyword">SELECT</span> <span class="token comment">/*+ ORDERED */</span>
  SQL_TEXT
<span class="token keyword">FROM</span> V$SQLTEXT TX
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>TX<span class="token punctuation">.</span>HASH_VALUE<span class="token punctuation">,</span> TX<span class="token punctuation">.</span>ADDRESS<span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> 
    DECODE<span class="token punctuation">(</span>SQL_HASH_VALUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> PREV_HASH_VALUE<span class="token punctuation">,</span> SQL_HASH_VALUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
    DECODE<span class="token punctuation">(</span>SQL_HASH_VALUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> PREV_SQL_ADDR<span class="token punctuation">,</span> SQL_ADDRESS<span class="token punctuation">)</span>
  <span class="token keyword">FROM</span> V$<span class="token keyword">SESSION</span> SESS
  <span class="token keyword">WHERE</span> SESS<span class="token punctuation">.</span>SID <span class="token operator">=</span> <span class="token operator">&amp;</span>SID
<span class="token punctuation">)</span> <span class="token comment">/* 此处为SID*/</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> PIECE <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看操作系统pid" tabindex="-1"><a class="header-anchor" href="#查看操作系统pid" aria-hidden="true">#</a> 查看操作系统PID</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">------------------------------------------</span>
<span class="token comment">--查看操作系统PID</span>
<span class="token comment">------------------------------------------</span>
<span class="token keyword">SELECT</span> 
  SPID<span class="token punctuation">,</span>OSUSER
  <span class="token punctuation">,</span>SESS<span class="token punctuation">.</span>PROGRAM 
<span class="token keyword">FROM</span> V$<span class="token keyword">SESSION</span> SESS
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> V$PROCESS PRO <span class="token keyword">ON</span> SESS<span class="token punctuation">.</span>PADDR<span class="token operator">=</span>PRO<span class="token punctuation">.</span>ADDR 
<span class="token keyword">WHERE</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>
  <span class="token operator">AND</span> SESS<span class="token punctuation">.</span>SID <span class="token operator">=</span> <span class="token operator">&amp;</span>SID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5);function O(_,L){const o=l("CodeTabs");return p(),i("div",null,[d,S,u(o,{id:"6",data:[{id:"查询锁表信息1"},{id:"查询锁表信息2"},{id:"查询锁表记录"}],"tab-id":"shell"},{title0:a(({value:e,isActive:t})=>[s("查询锁表信息1")]),title1:a(({value:e,isActive:t})=>[s("查询锁表信息2")]),title2:a(({value:e,isActive:t})=>[s("查询锁表记录")]),tab0:a(({value:e,isActive:t})=>[m]),tab1:a(({value:e,isActive:t})=>[v]),tab2:a(({value:e,isActive:t})=>[E]),_:1}),b])}const w=c(k,[["render",O],["__file","Lock.html.vue"]]);export{w as default};
